<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AR.js with A-Frame</title>
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  <script src="https://rawgit.com/mayognaise/aframe-face-tracking/master/dist/aframe-face-tracking.js"></script>
  <style>
    body { margin: 0; overflow: hidden; }
    #label, #model-info {
      position: absolute;
      bottom: 10px;
      left: 10px;
      color: white;
      background-color: rgba(0, 0, 0, 0.5);
      padding: 5px;
      border-radius: 5px;
      display: none;
    }
  </style>
</head>
<body>
  <a-scene embedded arjs='trackingMethod: best; sourceType: webcam;' face-tracking>
    <a-entity id="hat" gltf-model="/path/to/hat/model.gltf" position="0 0 0" rotation="0 0 0" scale="0.1 0.1 0.1" visible="false"></a-entity>
    <a-camera-static></a-camera-static>
  </a-scene>
  <div id="label"></div>
  <div id="model-info"></div>

  <script>
    const hat = document.getElementById('hat');
    const labelElement = document.getElementById('label');
    const modelInfoElement = document.getElementById('model-info');

    document.querySelector('a-scene').addEventListener('face-detected', (event) => {
      const { face } = event.detail;
      updateHatPosition(face);
    });

    function updateHatPosition(face) {
      const { boundingBox, landmarks } = face;
      if (boundingBox && landmarks) {
        const [leftEye, rightEye, nose, mouth] = landmarks;

        const headWidth = rightEye.x - leftEye.x;
        const headHeight = mouth.y - nose.y;

        const position = {
          x: (leftEye.x + rightEye.x) / 2,
          y: nose.y - headHeight * 0.5,
          z: -0.2  // Ajustar profundidad
        };

        const scale = {
          x: headWidth,
          y: headHeight * 1.5,
          z: headWidth
        };

        const dx = rightEye.x - leftEye.x;
        const dy = rightEye.y - leftEye.y;
        const angleZ = Math.atan2(dy, dx) * (180 / Math.PI);

        // Rotación de la gorra 180 grados en el eje Y
        const rotation = {
          x: 0,
          y: 180,
          z: angleZ
        };

        hat.setAttribute('position', `${position.x} ${position.y} ${position.z}`);
        hat.setAttribute('scale', `${scale.x} ${scale.y} ${scale.z}`);
        hat.setAttribute('rotation', `${rotation.x} ${rotation.y} ${rotation.z}`);
        hat.setAttribute('visible', true);

        labelElement.innerHTML = `Posición de la cabeza:<br>X: ${position.x.toFixed(2)}, Y: ${position.y.toFixed(2)}, Z: ${position.z.toFixed(2)}<br>Anchura de la cabeza: ${headWidth.toFixed(2)}<br>Altura de la cabeza: ${headHeight.toFixed(2)}`;
        modelInfoElement.innerHTML = `Modelo cargado. Posición: (${position.x.toFixed(2)}, ${position.y.toFixed(2)}, ${position.z.toFixed(2)})`;
        labelElement.style.display = 'block';
        modelInfoElement.style.display = 'block';
      } else {
        labelElement.style.display = 'none';
        modelInfoElement.style.display = 'none';
        hat.setAttribute('visible', false);
      }
    }
  </script>
</body>
</html>
